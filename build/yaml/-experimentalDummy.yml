pool:
  vmImage: 'windows-2019'

#variables:
  # NextBuild: define in Azure '[experimental]Dummy-build2'
  # PipelinesPersonalAccessToken: define in Azure

steps:
- task: colinsalmcorner.colinsalmcorner-buildtasks.tag-build-task.tagBuildOrRelease@0
  displayName: 'Tag Build with Build.Reason=$(Build.Reason) NextBuild=$(NextBuild)'
  inputs:
    tags: |
     Build.Reason=$(Build.Reason)
     NextBuild=$(NextBuild)
  continueOnError: true
  condition: always()

- task: benjhuser.tfs-extensions-build-tasks.trigger-build-task.TriggerBuild@3
  displayName: 'Trigger build $(NextBuild)'
  inputs:
    buildDefinition: '$(NextBuild)'
    queueBuildForUserThatTriggeredBuild: false
    buildParameters: 'MyBuildParameter: MBPValue'
    authenticationMethod: 'OAuth Token'
    enableBuildInQueueCondition: true
    blockingBuildsList: '$(NextBuild)'
  continueOnError: true
  condition: and(succeededOrFailed(), ne(variables['Build.Reason'], 'xxyxyx'), ne(variables['NextBuild'], ''), ne(variables['PipelinesPersonalAccessToken'], ''))
